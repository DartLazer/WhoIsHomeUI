{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div class="toast bg-success text-white" role="alert" aria-live="assertive" id="scannerToast"
             aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <strong class="me-auto">Saved</strong>
                <small class="text-white"><i class="bi bi-clock"></i> Now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Settings saved
            </div>
        </div>
    </div>

    {% if messages %}

        {% for message in messages %}
            <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
                <div aria-atomic="true" aria-live="assertive" class="toast bg-success text-white" id="liveToast"
                     role="alert">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">{% if message.extra_tags %}{{ message.extra_tags }} {% endif %}</strong>
                        <small class="text-white"><i class="bi bi-clock"></i> Now</small>
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="toast" type="button"></button>
                    </div>
                    <div class="toast-body">
                        {{ message | safe }}
                    </div>
                </div>
            </div>
        {% endfor %}

    {% endif %}


    <h3>Settings</h3>
    <!-- Rounded switch -->
    <hr/>
    <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-{% if scanner_running %}success{% else %}danger{% endif %} active" id="scannerButton">Scanner
            Status
            <input type="checkbox" id="startstop" {% if scanner_running %} checked {% endif %}onclick="scannerSwitch()">
        </label>
    </div>

    <br/>
    <br/>
    <p>
        <button aria-controls="collapseExample" aria-expanded="false" class="btn btn-secondary"
                data-bs-target="#scannerModal"
                data-bs-toggle="modal" type="button">
            Scanner Settings
        </button>
    </p>

    <div class="modal" id="scannerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Email Settings</h5>
                    <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                </div>
                <div class="modal-body">
                    <form action="{% url 'settings' %}" method="post">

                        {% csrf_token %}
                        {{ scanner_settings_form | crispy }}
                        <br/>
                        <button class="btn btn-primary" name="update_scanner_settings" type="submit">Save Settings
                        </button>
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% include "components/settings/email_settings.html" %}

    {% include "components/settings/discord_settings.html" %}

    {% include "components/settings/telegram_settings.html" %}

    {% include "components/settings/app_settings.html" %}



    <hr/>
    <p>Current time-zone setting: {{ timezone }} <i class="bi bi-info-circle" rel="tooltip"
                                                    title="Edit the file .env in the base directory to change" id="blah"
                                                    style="font-size: 0.8rem;"></i></p>
    <br/>
    <hr/>



    <br/>
    <br/>
    <h4>Console Log</h4>

    {% for log in logfile %}
        <samp>{{ log }}</samp>
        <br/>
    {% endfor %}
    <script>

        $(document).ready(function () {
            $("[rel=tooltip]").tooltip({placement: 'right'});
        });


        function scannerSwitch() {
            const startStopInput = document.getElementById('startstop');
            var toastLiveExample = document.getElementById('scannerToast');
            var toast = new bootstrap.Toast(toastLiveExample);
            var scannerButton = document.getElementById('scannerButton');
            if (startStopInput.checked) {
                view = '/start_scanner';
                toast.show();
                scannerButton.className = 'btn btn-success';
            } else {
                view = '/stop_scanner';
                toast.show();
                scannerButton.className = 'btn btn-danger';
            }
            $.get(view,)
        };


    </script>

{% endblock content %}
